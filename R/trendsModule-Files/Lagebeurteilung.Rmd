---
title: "Epidemiologische Lagebeurteilung"
author: "Swiss National COVID-19 Science Task Force"
date: "`r format(Sys.time(), '%d.%m.%Y')`"
output:
  word_document: default
  html_document:
    df_print: paged
  pdf_document: default
---

```{r libraries, echo = FALSE, message = FALSE}
library(tidyverse)
library(lubridate)
library(here)
```

```{r load, echo = FALSE}
eventCounts <- qs::qread(here("data", "trends-eventCounts.qs")) %>% bind_rows()
incidenceTable <- qs::qread(here("data", "trends-incidenceTable.qs"))
popSizes <- read_csv(here("data", "popSizes.csv"),
  col_types = cols(.default = col_character(), year = col_double(), populationSize = col_double())) %>%
  mutate(region = recode(region, "LI" = "FL"))
```

```{r national, echo = FALSE}
reFiles <- c(here("data", "Re", "CHE-Estimates.rds"), here("data", "RePublic", "CHE-Estimates.rds"))
mostRecentReFile <- reFiles[which.max(file.mtime(reFiles))]

reproduction <- readRDS(mostRecentReFile)

r_cases <- subset(reproduction,
                  region == "CHE"
                  & data_type == "Confirmed cases"
                  & estimate_type == "Cori_slidingWindow")
r_cases_timeDeath <- r_cases
r_cases_timeHosp <- r_cases
r_cases <- r_cases[r_cases$date == max(r_cases$date), ]

r_hosp <- subset(reproduction,
                  region == "CHE"
                  & data_type == "Hospitalized patients"
                  & estimate_type == "Cori_slidingWindow")
r_hosp_timeDeath <- r_hosp

r_hosp <- r_hosp[r_hosp$date == max(r_hosp$date), ]
r_cases_timeHosp <- r_cases_timeHosp[r_cases_timeHosp$date == max(r_hosp$date), ]
  
r_deaths <- subset(reproduction,
                  region == "CHE"
                  & data_type == "Deaths"
                  & estimate_type == "Cori_slidingWindow")
r_deaths <- r_deaths[r_deaths$date == max(r_deaths$date), ]
r_hosp_timeDeath <- r_hosp_timeDeath[r_hosp_timeDeath$date == max(r_deaths$date), ]
r_cases_timeDeath <- r_cases_timeDeath[r_cases_timeDeath$date == max(r_deaths$date), ]
```

```{r numbers, echo = FALSE}
# ICU numbers

delete_icu <- 0
delete <- delete_icu
time_window <- 14
lastday <- today()
begin <- lastday - delete + 1 - time_window
end <- lastday - delete

icu <- eventCounts %>%
  filter(event == "icu", region == "CH", age_class == "all") %>%
  filter(date >= begin & date <= end)

# Daily deaths
delete_death <- 5
delete <- delete_death
begin <- lastday - delete + 1 - time_window
end <- lastday - delete

deaths <- eventCounts %>%
  filter(event == "deaths", region == "CH", age_class == "all") %>%
  filter(date >= begin & date <= end)

# cumulative Cases / 100'000
cases14d <- incidenceTable %>% filter(event == "cases", age_class == "all") %>%
  left_join(select(popSizes, region, regionName), by = "region")

# for printing:
cases14d_CH <- cases14d %>%
  filter(region == "CH")
cases14d_max <- cases14d %>%
  filter(valueNorm14daySum == max(cases14d$valueNorm14daySum))
cases14d_min <- cases14d %>%
  filter(valueNorm14daySum == min(cases14d$valueNorm14daySum))

```

```{r mortality, echo = FALSE}
# Death based on FOPH data
deaths_total <- eventCounts %>%
  filter(event == "deaths", region == "CH", age_class == "all", date >= "2020-10-01") %>%
  pull(count) %>%
  sum()

# Cantonal deaths based on openZH
corona_data <- read.csv("https://raw.githubusercontent.com/daenuprobst/covid19-cases-switzerland/master/covid19_fatalities_switzerland_openzh.csv")
corona_data$Date <- ymd(corona_data$Date)
corona_data_date <- tail(corona_data$Date, 1)
corona_data_deaths <- tail(corona_data$CH, 1) - corona_data$CH[corona_data$Date == ymd(20200930)]
```



## Allgemeine Situation

### Dynamik
Über die ganze Schweiz zeigt die SARS-CoV-2-Epidemie einen rückgängigen <!--- CHECK ---->
Verlauf. Die Schätzungen der effektiven Reproduktionszahl *R~e~* betragen[^1]:

* `r format(round(r_cases$median_R_mean, 2), decimal.mark = ",")` (95% Unsicherheitsintervall, UI: `r format(round(r_cases$median_R_lowHPD, 2), decimal.mark = ",")`-`r format(round(r_cases$median_R_highHPD, 2), decimal.mark = ",")`) aufgrund der bestätigten Fälle (per `r day(r_cases$date)`.`r month(r_cases$date)`.`r year(r_cases$date)`).

* `r format(round(r_hosp$median_R_mean, 2), decimal.mark = ",")` (95% UI: `r format(round(r_hosp$median_R_lowHPD, 2), decimal.mark = ",")`-`r format(round(r_hosp$median_R_highHPD, 2), decimal.mark = ",")`) aufgrund der Hospitalisationen, per `r day(r_hosp$date)`.`r month(r_hosp$date)`.`r year(r_hosp$date)`. Zum Vergleich aufgrund der bestätigten Fälle wird *R~e~* für den selben Tag auf  `r format(round(r_cases_timeHosp$median_R_mean, 2), decimal.mark = ",")` (95% UI: `r format(round(r_cases_timeHosp$median_R_lowHPD, 2), decimal.mark = ",")`-`r format(round(r_cases_timeHosp$median_R_highHPD, 2), decimal.mark = ",")`) geschätzt. 

* `r format(round(r_deaths$median_R_mean, 2), decimal.mark = ",")` (95% UI: `r format(round(r_deaths$median_R_lowHPD, 2), decimal.mark = ",")`-`r format(round(r_deaths$median_R_highHPD, 2), decimal.mark = ",")`) aufgrund der Todesfälle, per `r day(r_deaths$date)`.`r month(r_deaths$date)`.`r year(r_deaths$date)`. Zum Vergleich aufgrund der Hospitalisationen wird *R~e~* für den selben Tag auf  `r format(round(r_hosp_timeDeath$median_R_mean, 2), decimal.mark = ",")` (95% UI: `r format(round(r_hosp_timeDeath$median_R_lowHPD, 2), decimal.mark = ",")`-`r format(round(r_hosp_timeDeath$median_R_highHPD, 2), decimal.mark = ",")`) geschätzt. Aufgrund der bestätigten Fälle wird *R~e~* für den selben Tag auf  `r format(round(r_cases_timeDeath$median_R_mean, 2), decimal.mark = ",")` (95% UI: `r format(round(r_cases_timeDeath$median_R_lowHPD, 2), decimal.mark = ",")`-`r format(round(r_cases_timeDeath$median_R_highHPD, 2), decimal.mark = ",")`) geschätzt. 

Aufgrund von Meldeverzögerungen und Fluktuationen in den Daten könnten die Schätzwerte nachkorrigiert werden. Wir weisen darauf hin dass die *R~e~* Werte das Infektionsgeschehen vor 10 Tagen bis mehreren Wochen widerspiegelt aufgrund der Verzoegerung von Infektion und Eintreten eines Ereignis (Fallbestätigung, Hospitalisationen, Todesfall).
Eine Betrachtung der sieben Grossregionen der Schweiz zeigt, dass auch dort die Trends rückläufig sind. <!--- CHECK ---->

Die Analyse wird gestützt durch die beobachteten Verdopplungs- bzw. Halbwertszeiten der <!--- CHECK---> 
bestätigten Fälle, Hospitalisationen und Todesfälle über die letzten 14 Tage.[^2] 
Auch diese Werte spiegeln das Infektionsgeschehen vor 10 Tagen bis mehreren Wochen wider.

### Absolute Zahlen
Die kumulierte Anzahl der bestätigten Fälle über die letzten 14 Tage liegt bei `r round(cases14d_CH$valueNorm14daySum, 0)` pro 100'000 Einwohner. 
Die Positivitat liegt bei xxx (Stand DATUM, Tendenz abnehmend <!--- CHECK --->; 
*R~e~* basierend auf Positivitaet fuer DATUM(most recent estimate) ist xxx, 95% UI: yyy). <!---- TODO Dani - insert numbers / dates in this sentence automatically?  ---->

Die Anzahl der COVID-19-Patienten auf Intensivstationen 
blieb über die letzten 14 Tage auf hohem Niveau relativ stabil <!--- CHECK --->
im Bereich von `r range(icu$count)[1]`-`r range(icu$count)[2]`[^3] Personen.

Die Zahl der täglichen täglichen Todesfälle ueber die letzten 14 Tage war zwischen `r range(deaths$count)[1]`-`r range(deaths$count)[2]`.[^4]
Seit dem 1. Oktober 2020 weist das Bundesamt für Gesundheit `r format(deaths_total, big.mark = "'")` laborbestätigte Todesfälle aus.[^5] Die Kantone meldeten in dieser Zeit `r format(corona_data_deaths, big.mark = "'")` Todesfälle.[^6] Die Sterblichkeitsstatistik vom Bundesamt für Statistik weist über die letzten 11 gemeldeten Wochen <!--- CHECK --->
eine deutliche Übersterblichkeit in der Altersgruppe 65 Jahre und älter auf.[^7] 
Diese Übersterblichkeit zeigt sich in allen Grossregionen der Schweiz mit Ausnahme der Genferseeregion.[^8] <!--- CHECK --->



## Neue Varianten
In der Schweiz sind die ursprünglich in Grossbritannien und Südafrika beschriebenen Varianten B.1.1.7 und 501.V2 erstmals in Kalenderwoche 51 des Jahres 2020 identifiziert worden. Epidemiologische Analysen und Daten aus der Kontaktverfolgung weisen darauf hin, dass diese Varianten eine höhere Übertragungsrate haben als die bislang bekannten Stämme von SARS-CoV-2 [^13]. Die genetische Charakterisierung von Zufallsstichproben aus positiv getesteten Menschen von Testlabors sowie die systematische genetische Charakterisierung von Proben im Referenzlabor in Genf erlaubt, die Häufigkeit von Infektionen mit diesen Varianten in der Schweiz über die Zeit zu verfolgen. Der Anteil dieser Varianten an allen Infektionen nahm seit dem ersten Nachweis kontinuierlich zu. 
In Kalenderwoche 2, 2020 (ab dem 11.1.2021) wurde die Häufigkeit von B.1.1.7 in der Schweiz auf etwa 4.0% geschätzt (95%-Unsicherheitsinterval 2.5-6.2%; das reflektiert das Infektionsgeschehen etwa 10 Tage früher[^14]) <!---- TODO Zahlen in diesem Satz automatisch holen von https://ibz-shiny.ethz.ch/covidDashboard/variant-plot/index.html (most recent total estimate)! ---->



<!--- ## Beurteilung
Die SARS-CoV-2-Epidemie zeigt auf nationaler Ebene seit mehreren Wochen einen relativ stabilen Verlauf. Schweizweit liegt *R~e~* für all drei Indikatoren oberhalb des von der Swiss National COVID-19 Science Task Force vorgeschlagenen Zielwerts von 0,8. Durch die Einführung von national einheitlichen Massnahmen hat sich der Verlauf der Epidemie in den unterschiedlichen Regionen angeglichen. [^11] --->

<!--- Die kumulierte Anzahl der täglich bestätigten Fälle über die letzten 14 Tage liegt in allen Kantonen deutlich über der Schwelle von 60 pro 100'000 Einwohner. Die Testpositivität ist deutlich über dem von der Weltgesundheitsorganisation empfohlenen Schwellenwert von 5%. Die aktuelle Belastung für das Gesundheitssystem und die Zahl der täglichen Todesfälle ist in vielen Kantonen nach wie vor sehr hoch. Falls der Wintersport und die Festtage zu vermehrten Ansteckungen geführt haben, wird sich dies in einem Anstieg der bestätigten Fälle im Verlauf vom Januar niederschlagen. Zudem besteht das Risiko, dass eine Ausbreitung der bereits in der Schweiz nachgewiesenen neuen Variante von SARS-CoV-2 mit einer wahrscheinlich erhöhten Übertragung innerhalb der nächsten Wochen zu einem Anstieg der Epidemie und einer noch stärkeren Belastung des Gesundheitssystems führen wird.[^12] --->

[^1]: https://sciencetaskforce.ch/reproduktionszahl/ und https://ibz-shiny.ethz.ch/covid-19-re-international/: Die Schätzungen von *R~e~* über die letzten Tage können leichten Schwankungen unterliegen. Diese Schwankungen treten insbesondere in kleinen Regionen, bei sich ändernder Dynamik und bei niederen Fallzahlen auf. Aufgrund der verwendeten Methodik kann die tatsächliche Unsicherheit um die Schätzwerte nicht immer vollständig dargestellt werden.
[^2]: https://ibz-shiny.ethz.ch/covidDashboard/trends: Aufgrund von Melderverzögerungen werden die letzten 3 respektive 5 Tage für bestätigte Fälle und Hospitalisationen/Todesfälle nicht berücksichtigt.
[^3]: https://icumonitoring.ch
[^4]: https://www.covid19.admin.ch
[^5]: https://www.covid19.admin.ch
[^6]: https://github.com/openZH/covid_19 und https://github.com/daenuprobst/covid19-cases-switzerland
[^7]: https://www.bfs.admin.ch/bfs/de/home/statistiken/gesundheit/gesundheitszustand/sterblichkeit-todesursachen.html
[^8]: https://www.experimental.bfs.admin.ch/expstat/de/home/innovative-methoden/momo.html
[^9]: https://sciencetaskforce.ch/beurteilung-der-lage-13-november-2020
[^10]: https://ibz-shiny.ethz.ch/covidDashboard/tables
[^11]: https://sciencetaskforce.ch/reproduktionszahl/ und https://ibz-shiny.ethz.ch/covid-19-re-international/
[^12]: https://www.ecdc.europa.eu/en/publications-data/threat-assessment-brief-rapid-increase-sars-cov-2-variant-united-kingdom
[^13]: https://sciencetaskforce.ch/wp-content/uploads/2021/01/Wissenschaftliches_Update14Jan21-DE-1.pdf
[^14]: https://sciencetaskforce.ch/nextstrain-phylogentische-analysen/







<!---- deleted stuff! ---->

```{r regional, echo = FALSE}
regional <- subset(reproduction,
                    (grepl("grR", region))
                    & data_type == "Confirmed cases"
                    & estimate_type == "Cori_slidingWindow")

regional <- regional[regional$date == max(regional$date), ]
regional <- regional[order(regional$median_R_mean), ]

regional$region[regional$region == "grR Central Switzerland"] <- "Zentralschweiz"
regional$region[regional$region == "grR Eastern Switzerland"] <- "Ostschweiz"
regional$region[regional$region == "grR Espace Mittelland"] <- "Espace Mittelland"
regional$region[regional$region == "grR Lake Geneva Region"] <- "Région lémanique"
regional$region[regional$region == "grR Northwestern Switzerland"] <- "Nordwestschweiz"
regional$region[regional$region == "grR Ticino"] <- "Ticino"
regional$region[regional$region == "grR Zurich"] <- "Zürich"

threshold <- 0.8

regional_below <- regional[regional$median_R_mean <= threshold, ]
below <- ""
for(i in 1:dim(regional_below)[1]) {
  ifelse(i < dim(regional_below)[1], last <- ", ", last <- "")
  below <- paste0(below,
                  regional_below$region[i], 
                  " mit ",
                  format(round(regional_below$median_R_mean[i], 2), decimal.mark = ","),
                  "; 95% UI: ",
                  format(round(regional_below$median_R_lowHPD[i], 2), decimal.mark = ","),
                  "-",
                  format(round(regional_below$median_R_highHPD[i], 2), decimal.mark = ","),
                  last)
}

regional_above <- regional[regional$median_R_mean > threshold, ]
above <- ""
for(i in 1:dim(regional_above)[1]) {
  ifelse(i < dim(regional_above)[1], last <- "), ", last <- ")")
  above <- paste0(above,
                  regional_above$region[i], 
                  " (",
                  format(round(regional_above$median_R_mean[i], 2), decimal.mark = ","),
                  "; 95% UI: ",
                  format(round(regional_above$median_R_lowHPD[i], 2), decimal.mark = ","),
                  "-",
                  format(round(regional_above$median_R_highHPD[i], 2), decimal.mark = ","),
                  last)
}
```

<!--- ## Regionale Unterschiede
Es bestehen regionale und kantonale Unterschiede im Verlauf der SARS-CoV-2-Epidemie. Die kumulierte Anzahl der täglich bestätigten Fälle über die letzten 14 Tage pro 100'000 Einwohner liegt zwischen `r round(cases14d_min$valueNorm14daySum, 0)` (`r cases14d_min$regionName`) und `r round(cases14d_max$valueNorm14daySum, 0)` (`r cases14d_max$regionName`). In allen 7 Grossregionen liegt *R~e~* aufgrund der bestätigten Fälle (Median) derzeit über dem von der Swiss National COVID-19 Science Task Force vorgeschlagenen Zielwert von 0,8, welcher zu einer Halbierung der Anzahl Neuinfektionen innerhalb maximal 14 Tagen führt:[^9] `r above`. Die Werte von *R~e~* können auf kantonaler Ebene auch innerhalb einer Grossregion grössere Unterschiede aufweisen.[^10] --->
